(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{13:function(e,r,t){e.exports={App:"App_App__3_dc-",Panel:"App_Panel__39z3m"}},16:function(e,r,t){e.exports=t(28)},21:function(e,r,t){},28:function(e,r,t){"use strict";t.r(r);var n,a=t(0),c=t.n(a),o=t(7),i=t.n(o),u=(t(21),t(3)),E=t(1),l=t(13),f=t.n(l),s=t(4),I=t(2),T=t(9),v=Math.min(.6*window.innerWidth/10,.8*window.innerHeight/22),P={APP_NAME:"Tetrix",PLAYGROUND_WIDTH:10,PLAYGROUND_HEIGHT:22,PLAYGROUND_TOPLEFT:[0,0],PLAYGROUNDCANVAS_WIDTH:10*v+10,PLAYGROUNDCANVAS_HEIGHT:22*v+10,PIECE_SIZE:v};!function(e){e.STICK="STICK",e.L="L",e.J="J",e.S="S",e.Z="Z",e.SQUARE="SQUARE",e.PYRAMID="PYRAMID"}(n||(n={}));var d,_={STICK:[[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],L:[[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]]],J:[[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]]],S:[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]],Z:[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],SQUARE:[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],PYRAMID:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]]};!function(e){e[e.EMPTY=0]="EMPTY",e[e.OCCUPIED=1]="OCCUPIED",e[e.STABLED=2]="STABLED"}(d||(d={}));var A=function(e,r){return{piece:_[e][r].map((function(r){return r.map((function(r){return 1===r?{state:d.OCCUPIED,type:e}:{state:d.EMPTY,type:void 0}}))})),type:e,direction:r}},O=function(e){switch(e){case n.L:return"red";case n.J:return"orange";case n.S:return"yellow";case n.Z:return"green";case n.STICK:return"blue";case n.SQUARE:return"indigo";case n.PYRAMID:return"violet";default:return"white"}},R=function(e){var r=Object(a.useRef)(null),t=e.grid;return Object(a.useEffect)((function(){var e=function(e,r,t,n,a){e[n][a].state===d.EMPTY?r.strokeRect(t[1]+a*P.PIECE_SIZE,t[0]+n*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE):(r.save(),r.fillStyle=O(e[n][a].type),r.fillRect(t[1]+a*P.PIECE_SIZE,t[0]+n*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE),r.restore())},n=r.current;if(n){var a=n.getContext("2d"),c=P.PLAYGROUND_TOPLEFT;if(a){a.clearRect(c[0],c[1],P.PLAYGROUNDCANVAS_WIDTH,P.PLAYGROUNDCANVAS_HEIGHT);for(var o=2;o<P.PLAYGROUND_HEIGHT;o++)for(var i=0;i<P.PLAYGROUND_WIDTH;i++)e(t,a,c,o,i)}}}),[t]),c.a.createElement("canvas",{ref:r,width:P.PLAYGROUNDCANVAS_WIDTH,height:P.PLAYGROUNDCANVAS_HEIGHT},"Please use a newer verison of browser to play the game.")},S={LOAD_GRID:"LOAD_GRID",GENERATE_PIECE:"GENERATE_PIECE",UPDATE_SCORE:"UPDATE_SCORE",UPDATE_LINE:"UPDATE_LINE",TIMER_START:"TIMER_START",TIMER_INCREMENT:"TIMER_INCREMENT",TIMER_STOP:"TIMER_STOP"},D=function(e){return{type:S.LOAD_GRID,payload:e}},p=function(){return{type:S.TIMER_STOP}},C=function(e){return{type:S.UPDATE_SCORE,payload:{lineCleared:e}}},N=function(e){return{type:S.UPDATE_LINE,payload:{lineCleared:e}}},m=function(e,r){return!(e<0||e>=P.PLAYGROUND_HEIGHT||r<0||r>=P.PLAYGROUND_WIDTH)},L=function(e,r,t,n){!function(e){for(var r=0;r<P.PLAYGROUND_HEIGHT;r++)for(var t=0;t<P.PLAYGROUND_WIDTH;t++)e[r][t].state!==d.STABLED&&(e[r][t]={state:d.EMPTY,type:void 0})}(e);for(var a=0;a<4;a++)for(var c=0;c<4;c++)m(r+a,t+c)&&e[a+r][c+t].state!==d.STABLED&&(e[a+r][c+t]=Object(I.a)({},n.piece[a][c]))},w=function(e,r,t,n){for(var a=0;a<4;a++)for(var c=0;c<4;c++)if(r.piece[a][c].state===d.OCCUPIED){if(!m(t+a,n+c))return!1;if(e[t+a][n+c].state===d.STABLED)return!1}return!0},b=function(e,r,t,n){return w(e,r,t+1,n)?(L(e,t+1,n,r),{row:t+1,col:n}):null},y=function(){var e=Object(E.c)((function(e){return e.playground.grid})),r=Object(E.c)((function(e){return e.timer})),t=Object(E.c)((function(e){return e.playground.pieceQueue})),n=Object(a.useState)({row:0,col:3}),o=Object(s.a)(n,2),i=o[0],u=o[1],l=Object(a.useState)(t[0]),f=Object(s.a)(l,2),I=f[0],v=f[1],O=Object(a.useState)(r.currentTime),m=Object(s.a)(O,2),y=m[0],G=m[1],U=Object(a.useState)(0),h=Object(s.a)(U,2),Y=h[0],g=h[1],M=Object(a.useState)(!1),H=Object(s.a)(M,2),j=H[0],Z=H[1],k=Object(E.b)();return Object(a.useEffect)((function(){var e=setInterval((function(){return k({type:S.TIMER_INCREMENT})}),1e3);return function(){console.log("clear side effects."),clearInterval(e)}}),[k]),Object(a.useEffect)((function(){var t=r.currentTime,n=function(r){if(I&&i&&!j&&i.row>=1){switch(r.keyCode){case 32:var n=function(e,r,t,n){for(var a=t,c=t+1;c<P.PLAYGROUND_HEIGHT;c++)if(!w(e,r,c,n)){a=c;break}return L(e,a-1,n,r),{row:a-1,col:n}}(e,I,i.row,i.col);u(n),Z(!0);break;case 37:var a=function(e,r,t,n){return w(e,r,t,n-1)?(L(e,t,n-1,r),{row:t,col:n-1}):{row:t,col:n}}(e,I,i.row,i.col);u(a);break;case 38:var c=function(e,r,t,n){var a=(r.direction+1)%_[r.type].length,c=A(r.type,a);return w(e,c,t,n)?(L(e,t,n,c),c):r}(e,I,i.row,i.col);v(c);break;case 39:var o=function(e,r,t,n){return w(e,r,t,n+1)?(L(e,t,n+1,r),{row:t,col:n+1}):{row:t,col:n}}(e,I,i.row,i.col);u(o);break;case 40:var E=b(e,I,i.row,i.col);E&&u(E);break;default:console.log("Invalid keyboard event: ".concat(r))}g(t),k(D(e))}else console.log("Invalid keyboard event: ".concat(r))};return window.addEventListener("keydown",n),function(){window.removeEventListener("keydown",n)}})),Object(a.useEffect)((function(){var n=r.currentTime;if(function(){if(!I)return!0;if(n-y===25)return!0;if(j)return Z(!1),!0;var r=w(e,I,i.row+1,i.col);return!(r||!function(e){for(var r=0;r<e.length;r++){for(var t=!0,n=0;n<e[r].length;n++)e[r][n].state===d.EMPTY&&(t=!1);if(t)return!0}}(e))||!r&&n-Y>=1}()){!function(e){for(var r=0;r<P.PLAYGROUND_HEIGHT;r++)for(var t=0;t<P.PLAYGROUND_WIDTH;t++)e[r][t].state===d.OCCUPIED&&(e[r][t].state=d.STABLED)}(e);var a=function(e){for(var r=0,t=0;t<e.length;t++){for(var n=!0,a=0;a<e[t].length;a++)e[t][a].state===d.EMPTY&&(n=!1);if(n){for(var c=t;c>0;c--)e[c]=Object(T.a)(e[c-1]);e[0]=new Array(P.PLAYGROUND_WIDTH).fill({state:d.EMPTY,type:void 0}),r++}}return r}(e);a>0&&(k(N(a)),k(C(a))),k({type:S.GENERATE_PIECE});var c=t[0];w(e,c,0,3)||(window.confirm("Game Over!")?(!function(e){for(var r=0;r<P.PLAYGROUND_HEIGHT;r++)for(var t=0;t<P.PLAYGROUND_WIDTH;t++)e[r][t]={state:d.EMPTY,type:void 0}}(e),k(D(e)),k(p()),k(N(-P.PLAYGROUND_WIDTH)),k(C(-P.PLAYGROUND_WIDTH))):k(p())),v(c),u({row:0,col:3}),G(n)}else{if(!I)throw console.error("currentPiece is null or undefined!"),Error("currentPiece is null or undefined!");var o=b(e,I,i.row,i.col);o&&u(o)}k(D(e))}),[r,k]),c.a.createElement(R,{grid:e,redraw:Y})},G=t(6),U=t.n(G),h=function(e){return c.a.createElement("div",{className:U.a.ScoreBoard},c.a.createElement("div",{className:U.a.Element},"Score: ",e.score),c.a.createElement("div",{className:U.a.Element},"Level: ",e.level),c.a.createElement("div",{className:U.a.Element},"Line: ",e.line))},Y=function(){var e=Object(E.c)((function(e){return e.score.score})),r=Object(E.c)((function(e){return e.score.line}));return c.a.createElement(h,{score:e,level:Math.floor(r/10)+1,line:r})},g=function(e){var r=Object(a.useRef)(null),t=e.piece;return Object(a.useEffect)((function(){var e=function(e,r,t,n){e[t][n].state===d.EMPTY?(r.save(),r.fillStyle="rgb(0, 0, 0, 0)",r.fillRect(n*P.PIECE_SIZE,t*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE),r.restore()):(r.save(),r.fillStyle=O(e[t][n].type),r.fillRect(n*P.PIECE_SIZE,t*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE),r.restore())};if(t){var n=t.piece,a=r.current;if(a){var c=a.getContext("2d");if(c){c.clearRect(0,0,a.width,a.height);for(var o=0;o<4;o++)for(var i=0;i<4;i++)e(n,c,o,i)}}}}),[t]),c.a.createElement("div",null,c.a.createElement("p",null,"Next:"),c.a.createElement("br",null),c.a.createElement("canvas",{ref:r,width:4*P.PIECE_SIZE,height:4*P.PIECE_SIZE},"Please use a newer verison of browser to play the game."))},M=function(){var e=Object(E.c)((function(e){return e.playground.pieceQueue})),r=e.length>1?e[1]:null;return c.a.createElement(g,{piece:r})};var H=function(){return c.a.createElement("div",{className:f.a.App},c.a.createElement(y,null),c.a.createElement("div",{className:f.a.Panel},c.a.createElement(M,null),c.a.createElement(Y,null)))},j=function(e){return Math.floor(Math.random()*Math.floor(e))},Z=function(){var e=function(){switch(j(7)){case 0:return n.L;case 1:return n.J;case 2:return n.S;case 3:return n.Z;case 4:return n.STICK;case 5:return n.SQUARE;case 6:return n.PYRAMID;default:return n.L}}(),r=j(_[e].length);return A(e,r)},k={grid:new Array(P.PLAYGROUND_HEIGHT).fill(0).map((function(e){return new Array(P.PLAYGROUND_WIDTH).fill({state:d.EMPTY,type:void 0})})),pieceQueue:[Z(),Z()]},W={score:0,line:0},B=function(e){return 1===e?40:2===e?100:3===e?300:4===e?1200:0},Q={currentTime:0},x=Object(u.b)({playground:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case S.LOAD_GRID:var t=r;return Object(I.a)({},e,{grid:JSON.parse(JSON.stringify(t.payload))});case S.GENERATE_PIECE:var n=Z();e.pieceQueue.length>0&&e.pieceQueue.shift();var a=[].concat(Object(T.a)(e.pieceQueue),[n]);return Object(I.a)({},e,{pieceQueue:a});default:return e}},score:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case S.UPDATE_SCORE:var t=r;return t.payload.lineCleared<0?W:Object(I.a)({},e,{score:e.score+B(t.payload.lineCleared)});case S.UPDATE_LINE:var n=r;return n.payload.lineCleared<0?W:Object(I.a)({},e,{line:e.line+n.payload.lineCleared});default:return e}},timer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case S.TIMER_START:return{currentTime:0};case S.TIMER_INCREMENT:return{currentTime:e.currentTime+1};case S.TIMER_STOP:return{currentTime:-1};default:return e}}}),J=Object(u.c)(x);i.a.render(c.a.createElement(E.a,{store:J},c.a.createElement(H,null)),document.getElementById("root"))},6:function(e,r,t){e.exports={ScoreBoard:"ScoreBoard_ScoreBoard__3ExwN",Element:"ScoreBoard_Element__rxEAU"}}},[[16,1,2]]]);
//# sourceMappingURL=main.6e9e0ae3.chunk.js.map