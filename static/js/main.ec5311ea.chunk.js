(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{13:function(e,t,r){e.exports={App:"App_App__msOkL",Panel:"App_Panel__2ZHDO"}},16:function(e,t,r){e.exports=r(28)},21:function(e,t,r){},28:function(e,t,r){"use strict";r.r(t);var n,a=r(0),c=r.n(a),o=r(7),i=r.n(o),u=(r(21),r(3)),E=r(1),l=r(13),f=r.n(l),s=r(4),I=r(2),T=r(9),v=Math.min(.6*window.innerWidth/10,.8*window.innerHeight/22),P={APP_NAME:"Tetrix",PLAYGROUND_WIDTH:10,PLAYGROUND_HEIGHT:22,PLAYGROUND_TOPLEFT:[0,0],PLAYGROUNDCANVAS_WIDTH:10*v+10,PLAYGROUNDCANVAS_HEIGHT:22*v+10,PIECE_SIZE:v};!function(e){e.STICK="STICK",e.L="L",e.J="J",e.S="S",e.Z="Z",e.SQUARE="SQUARE",e.PYRAMID="PYRAMID"}(n||(n={}));var O,d={STICK:[[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],L:[[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]]],J:[[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]]],S:[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]],Z:[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],SQUARE:[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],PYRAMID:[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]]};!function(e){e[e.EMPTY=0]="EMPTY",e[e.OCCUPIED=1]="OCCUPIED",e[e.STABLED=2]="STABLED"}(O||(O={}));var _=function(e,t){return{piece:d[e][t].map((function(t){return t.map((function(t){return 1===t?{state:O.OCCUPIED,type:e}:{state:O.EMPTY,type:void 0}}))})),type:e,direction:t}},A=function(e){switch(e){case n.L:return"red";case n.J:return"orange";case n.S:return"yellow";case n.Z:return"green";case n.STICK:return"blue";case n.SQUARE:return"indigo";case n.PYRAMID:return"violet";default:return"white"}},R=function(e){var t=Object(a.useRef)(null),r=e.grid;return Object(a.useEffect)((function(){var e=function(e,t,r,n,a){e[n][a].state===O.EMPTY?t.strokeRect(r[1]+a*P.PIECE_SIZE,r[0]+n*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE):(t.save(),t.fillStyle=A(e[n][a].type),t.fillRect(r[1]+a*P.PIECE_SIZE,r[0]+n*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE),t.restore())},n=t.current;if(n){var a=n.getContext("2d"),c=P.PLAYGROUND_TOPLEFT;if(a){a.clearRect(c[0],c[1],P.PLAYGROUNDCANVAS_WIDTH,P.PLAYGROUNDCANVAS_HEIGHT);for(var o=2;o<P.PLAYGROUND_HEIGHT;o++)for(var i=0;i<P.PLAYGROUND_WIDTH;i++)e(r,a,c,o,i)}}}),[r]),c.a.createElement("canvas",{ref:t,width:P.PLAYGROUNDCANVAS_WIDTH,height:P.PLAYGROUNDCANVAS_HEIGHT},"Please use a newer verison of browser to play the game.")},S={LOAD_GRID:"LOAD_GRID",GENERATE_PIECE:"GENERATE_PIECE",UPDATE_SCORE:"UPDATE_SCORE",UPDATE_LINE:"UPDATE_LINE",TIMER_START:"TIMER_START",TIMER_INCREMENT:"TIMER_INCREMENT",TIMER_STOP:"TIMER_STOP"},D=function(e){return{type:S.LOAD_GRID,payload:e}},p=function(){return{type:S.TIMER_STOP}},C=function(e){return{type:S.UPDATE_SCORE,payload:{lineCleared:e}}},N=function(e){return{type:S.UPDATE_LINE,payload:{lineCleared:e}}},b=function(e,t){return!(e<0||e>=P.PLAYGROUND_HEIGHT||t<0||t>=P.PLAYGROUND_WIDTH)},m=function(e,t,r,n){!function(e){for(var t=0;t<P.PLAYGROUND_HEIGHT;t++)for(var r=0;r<P.PLAYGROUND_WIDTH;r++)e[t][r].state!==O.STABLED&&(e[t][r]={state:O.EMPTY,type:void 0})}(e);for(var a=0;a<4;a++)for(var c=0;c<4;c++)b(t+a,r+c)&&e[a+t][c+r].state!==O.STABLED&&(e[a+t][c+r]=Object(I.a)({},n.piece[a][c]))},L=function(e,t,r,n){for(var a=0;a<4;a++)for(var c=0;c<4;c++)if(t.piece[a][c].state===O.OCCUPIED){if(!b(r+a,n+c))return!1;if(e[r+a][n+c].state===O.STABLED)return!1}return!0},w=function(e,t,r,n){return L(e,t,r+1,n)?(m(e,r+1,n,t),{row:r+1,col:n}):null},y=function(){var e=Object(E.c)((function(e){return e.playground.grid})),t=Object(E.c)((function(e){return e.timer})),r=Object(E.c)((function(e){return e.playground.pieceQueue})),n=Object(a.useState)({row:0,col:3}),o=Object(s.a)(n,2),i=o[0],u=o[1],l=Object(a.useState)(r[0]),f=Object(s.a)(l,2),I=f[0],v=f[1],A=Object(a.useState)(t.currentTime),b=Object(s.a)(A,2),y=b[0],G=b[1],h=Object(a.useState)(0),U=Object(s.a)(h,2),Y=U[0],g=U[1],M=Object(a.useState)(!1),j=Object(s.a)(M,2),H=j[0],Z=j[1],k=Object(E.b)();return Object(a.useEffect)((function(){var e=setInterval((function(){return k({type:S.TIMER_INCREMENT})}),1e3);return function(){console.log("clear side effects."),clearInterval(e)}}),[k]),Object(a.useEffect)((function(){var r=t.currentTime,n=function(t){if(I&&i&&!H&&i.row>=1){switch(t.keyCode){case 32:var n=function(e,t,r,n){for(var a=r,c=r+1;c<P.PLAYGROUND_HEIGHT;c++)if(!L(e,t,c,n)){a=c;break}return m(e,a-1,n,t),{row:a-1,col:n}}(e,I,i.row,i.col);u(n),Z(!0);break;case 37:var a=function(e,t,r,n){return L(e,t,r,n-1)?(m(e,r,n-1,t),{row:r,col:n-1}):{row:r,col:n}}(e,I,i.row,i.col);u(a);break;case 38:var c=function(e,t,r,n){var a=(t.direction+1)%d[t.type].length,c=_(t.type,a);return L(e,c,r,n)?(m(e,r,n,c),c):t}(e,I,i.row,i.col);v(c);break;case 39:var o=function(e,t,r,n){return L(e,t,r,n+1)?(m(e,r,n+1,t),{row:r,col:n+1}):{row:r,col:n}}(e,I,i.row,i.col);u(o);break;case 40:var E=w(e,I,i.row,i.col);E&&u(E);break;default:console.log("Invalid keyboard event: ".concat(t))}g(r),k(D(e))}else console.log("Invalid keyboard event: ".concat(t))};return window.addEventListener("keydown",n),function(){window.removeEventListener("keydown",n)}})),Object(a.useEffect)((function(){var n=t.currentTime;if(function(){if(!I)return!0;if(n-y===25)return!0;if(H)return Z(!1),!0;var t=L(e,I,i.row+1,i.col);return!(t||!function(e){for(var t=0;t<e.length;t++){for(var r=!0,n=0;n<e[t].length;n++)e[t][n].state===O.EMPTY&&(r=!1);if(r)return!0}}(e))||!t&&n-Y>=1}()){!function(e){for(var t=0;t<P.PLAYGROUND_HEIGHT;t++)for(var r=0;r<P.PLAYGROUND_WIDTH;r++)e[t][r].state===O.OCCUPIED&&(e[t][r].state=O.STABLED)}(e);var a=function(e){for(var t=0,r=0;r<e.length;r++){for(var n=!0,a=0;a<e[r].length;a++)e[r][a].state===O.EMPTY&&(n=!1);if(n){for(var c=r;c>0;c--)e[c]=Object(T.a)(e[c-1]);e[0]=new Array(P.PLAYGROUND_WIDTH).fill({state:O.EMPTY,type:void 0}),t++}}return t}(e);a>0&&(k(N(a)),k(C(a))),k({type:S.GENERATE_PIECE});var c=r[0];L(e,c,0,3)||(window.confirm("Game Over!")?(!function(e){for(var t=0;t<P.PLAYGROUND_HEIGHT;t++)for(var r=0;r<P.PLAYGROUND_WIDTH;r++)e[t][r]={state:O.EMPTY,type:void 0}}(e),k(D(e)),k(p()),k(N(-P.PLAYGROUND_WIDTH)),k(C(-P.PLAYGROUND_WIDTH))):k(p())),v(c),u({row:0,col:3}),G(n)}else{if(!I)throw console.error("currentPiece is null or undefined!"),Error("currentPiece is null or undefined!");var o=w(e,I,i.row,i.col);o&&u(o)}k(D(e))}),[t,k]),c.a.createElement(R,{grid:e,redraw:Y})},G=r(6),h=r.n(G),U=function(e){return c.a.createElement("div",{className:h.a.ScoreBoard},c.a.createElement("div",{className:h.a.Element},"Score: ",e.score),c.a.createElement("div",{className:h.a.Element},"Level: ",e.level),c.a.createElement("div",{className:h.a.Element},"Line: ",e.line))},Y=function(){var e=Object(E.c)((function(e){return e.score.score})),t=Object(E.c)((function(e){return e.score.line}));return c.a.createElement(U,{score:e,level:Math.floor(t/10)+1,line:t})},g=function(e){var t=Object(a.useRef)(null),r=e.piece;return Object(a.useEffect)((function(){var e=function(e,t,r,n){e[r][n].state===O.EMPTY?(t.save(),t.fillStyle="rgb(0, 0, 0, 0)",t.fillRect(n*P.PIECE_SIZE,r*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE),t.restore()):(t.save(),t.fillStyle=A(e[r][n].type),t.fillRect(n*P.PIECE_SIZE,r*P.PIECE_SIZE,P.PIECE_SIZE,P.PIECE_SIZE),t.restore())};if(r){var n=r.piece,a=t.current;if(a){var c=a.getContext("2d");if(c){c.clearRect(0,0,a.width,a.height);for(var o=0;o<4;o++)for(var i=0;i<4;i++)e(n,c,o,i)}}}}),[r]),c.a.createElement("div",null,c.a.createElement("p",null,"Next:"),c.a.createElement("br",null),c.a.createElement("canvas",{ref:t,width:4*P.PIECE_SIZE,height:4*P.PIECE_SIZE},"Please use a newer verison of browser to play the game."))},M=function(){var e=Object(E.c)((function(e){return e.playground.pieceQueue})),t=e.length>1?e[1]:null;return c.a.createElement(g,{piece:t})};var j=function(){return c.a.createElement("div",{className:f.a.App},c.a.createElement(y,null),c.a.createElement("div",{className:f.a.Panel},c.a.createElement(M,null),c.a.createElement(Y,null)))},H=function(e){return Math.floor(Math.random()*Math.floor(e))},Z=function(){var e=function(){switch(H(7)){case 0:return n.L;case 1:return n.J;case 2:return n.S;case 3:return n.Z;case 4:return n.STICK;case 5:return n.SQUARE;case 6:return n.PYRAMID;default:return n.L}}(),t=H(d[e].length);return _(e,t)},k={grid:new Array(P.PLAYGROUND_HEIGHT).fill(0).map((function(e){return new Array(P.PLAYGROUND_WIDTH).fill({state:O.EMPTY,type:void 0})})),pieceQueue:[Z(),Z()]},W={score:0,line:0},B=function(e){return 1===e?40:2===e?100:3===e?300:4===e?1200:0},Q={currentTime:0},J=Object(u.b)({playground:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.LOAD_GRID:var r=t;return Object(I.a)(Object(I.a)({},e),{},{grid:JSON.parse(JSON.stringify(r.payload))});case S.GENERATE_PIECE:var n=Z();e.pieceQueue.length>0&&e.pieceQueue.shift();var a=[].concat(Object(T.a)(e.pieceQueue),[n]);return Object(I.a)(Object(I.a)({},e),{},{pieceQueue:a});default:return e}},score:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.UPDATE_SCORE:var r=t;return r.payload.lineCleared<0?W:Object(I.a)(Object(I.a)({},e),{},{score:e.score+B(r.payload.lineCleared)});case S.UPDATE_LINE:var n=t;return n.payload.lineCleared<0?W:Object(I.a)(Object(I.a)({},e),{},{line:e.line+n.payload.lineCleared});default:return e}},timer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.TIMER_START:return{currentTime:0};case S.TIMER_INCREMENT:return{currentTime:e.currentTime+1};case S.TIMER_STOP:return{currentTime:-1};default:return e}}}),x=Object(u.c)(J);i.a.render(c.a.createElement(E.a,{store:x},c.a.createElement(j,null)),document.getElementById("root"))},6:function(e,t,r){e.exports={ScoreBoard:"ScoreBoard_ScoreBoard__2gm-J",Element:"ScoreBoard_Element__3Mhyx"}}},[[16,1,2]]]);
//# sourceMappingURL=main.ec5311ea.chunk.js.map